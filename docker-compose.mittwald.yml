# ============================================================
# Docker Compose fuer Mittwald Studio (Container Hosting)
# Nur Garage â€” SSL/Ingress uebernimmt Mittwald
# Custom Image mit eingebetteter garage.toml (olivierdo/garage-staticpub)
# ============================================================

services:
  garage:
    image: olivierdo/garage-staticpub:v2.2.0
    volumes:
      - garage-meta:/var/lib/garage/meta
      - garage-data:/var/lib/garage/data
    environment:
      GARAGE_RPC_SECRET: ${GARAGE_RPC_SECRET}
      GARAGE_ADMIN_TOKEN: ${GARAGE_ADMIN_TOKEN}
    ports:
      - "3900:3900/tcp"
      - "3902:3902/tcp"
    restart: unless-stopped

  admin:
    image: olivierdo/staticpub-admin:latest
    ports:
      - "8000:8000/tcp"
    environment:
      S3_BUCKET: ${BUCKET_NAME}
      S3_ENDPOINT: http://garage:3900
      AWS_REGION: garage
      DOMAIN: ${DOMAIN_NAME}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      ADMIN_USER: ${ADMIN_USER}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}
      APP_PREFIX: /admin
    restart: unless-stopped

volumes:
  garage-meta:
  garage-data:
